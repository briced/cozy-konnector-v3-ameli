language: node_js
node_js:
  - '8'
env:
  global:
    # kosssi GITHUB_TOKEN
    - secure: "c4Mdc0HhRtDzi4U3ykwPawh7NvfkpDRzhQlBn0tG31YjZQ1Q2/IUHfKB/nQ1e/xMin8lg4UT/S3UxQZv3+9dn87LfrEBDw7HAmTOQi8uay2Nvvgjo3lpj3DA/YDbTXtvrVx529CfRohCYsVSAJy8QVyFnN1XXyHd2jV3P1JtWNastpKVqqVPXvO8O53GXQvLO4W2z738Z4JjzfCxeItGxhjc45kxwHvN//+VXO9qvJ31IsUPjGopReCf6SaATIVa5v3s6aNvbw83t5eB87O28CIhmjB2naG990D8mEZDsdHXCiyTS8l/qyEtZL8lxnWpySL+m0p0LZ31CFynq25fB1ZC1KdQQoxHZxpxriUxR1MTcU8QrCl0dAmm+aEGRh2b/qp0vfKnB21YayxWJkquli4PeD/MBQFTd6CHH8ZWMOvlHF4UR29Hh5A9l1jXbJfSwulbIF8Pv8ThqY/YNjD0qCQ9D19/lsXhghMBGUEsZKgUvdpgZ2YjE6eBwRFFe0bp85UBa1WaX3Uam5cMaKfCB75Vo3cP/m6VyB6QXSzmdb36KmWF8zY4TBIEVVsis4lFXV7ZDQ9Wpr2bUzq13q3YNngzF2/8+dPs4g+aqIRhz9LniHHDLKzd3gM9adXd5Befmj3GFcVvYGI/6JJuwc6nmxMzKHSv/348knebx44O4AQ="
  matrix:
    # kosssi account
    - secure: MhE6co+33V7zAChGxZMowpsNBpEDc5bA9STbqqSINCuzWpYF5I2u/4NMqqOK2SWhUmrW/B7yazdlvLM4+UT2OHfn11Jw8+sX1szkn6JoD5o1nNrI1rITx+4MLBEDFgs8FXiaTeg785d7b7i85PubikyaQYiSW7wRyoChcCFD6BLzw84CZHeGdD9XyKMwVuWps2ZzP6XijP5s6UD1ex9g8rCuqGjqrlESMQ7DBWT4DaQKGfAp3iF1LIjELBDyuLllwSMTgYvrwRueti7kO4LnnXaYMTLcyppr2Ztl3dtocsTvnaoff/XvwK1CfRnnW9G/a6ZilKrBEJ9NvWmPwNe4qbCBMcAb9c4GqJHWnRyCV8rOZYnrpS3w/IMrOeodr2ZZp6oQULFHCXXFSWU6DSeeZltmREeAMCw6gi30UO9ikaoo5m18wLDbs969A8v3VlXEyDzf4bx4MLtNPXBNEChZhQTmzLrBiTYLOKFL42nnSfRqCqu7yZ3AWdz9shgowK40DF2GhD+zSoRdRZst9TBnI/zjkzl11G+/71SptgYDNjmHFbzprQEydLal4pdzpztSAnz/lP9fePsw7Nx4zo5x8+XUuKx4N7JqdPEguSgP5bmFxcwwDvks2d1SZTy683lqtsCKr71iEzhKjpLZle6rIjYCdT7emPraYOZXRnSDnzA=
    # doubleface account
    - secure: WGDv0ZfknIO7SIgT+eiaKn8i7U7kvN3mG9eYvPeHBK64mC6pqMwYsWLEWTD1y3y5z/fz99yFRWXzgl+J+zq2RfkhmD2aEg/Dv1ZuTpPVgvQwG/Hpie37xxUcM3gghh+2nR4pPAqYgC9LLTLlz7SaKHexBEuE644PWvZuHTGzk8ybV53xbWJtHTHxE95RI1Qwp1Qz+lUHOd4VZLPS1Q0bCV6uaL31SeXEW8z3o/Jsgh0g11JfX27mg6bJC3h5TGndfkoxynXp9jlc95GTIRebc4R7/rnNcMPgFb4hyvKFjCiRyY1u/p/pexlwqxJ/UogjixXkz9QDd4xhC2Oi3NNdRg/lDBodwzl6Ro8Jpv7XE764q3mVq00YTHN1exAXgoNBSjfXzkV0jJ9prPZ3oh61KLmuKW6PuyFleeW+1Y28VhCemZx99eUWKtRsB+yDtj3Aq180kYdMlR4JLHNRC2gan60wbM4GuvgzvX5mVeEbig4WUloXvWoeYxUDXfP5lhLk7Suv3+i36lP1+KMTFDktKV2EI9MPqhaoTAGzUOoiQBSp8OFIkPVqYXx7pSBKHPGNnH5XFgW0FbyqO+kXDs+Gl5uv8QZFBubB6/hTnNiFimydybveJhWMv3Mq7aGpmGW9lEODAnrRcLfde7UVJScayx3JgIM/xtF5D4Ddnj7fjr8=
cache:
  yarn: true
  directories:
    - node_modules
script:
  - yarn build
  - if [ $TRAVIS_SECURE_ENV_VARS = "true" ]; then yarn test; fi
deploy:
  - provider: pages
    repo: konnectors/cozy-konnector-ameli
    skip-cleanup: true
    github-token: $GITHUB_TOKEN
    target-branch: build
    local-dir: ./build
    on:
      branch: master
  - provider: pages
    repo: konnectors/cozy-konnector-ameli
    skip-cleanup: true
    github-token: $GITHUB_TOKEN
    target-branch: latest
    local-dir: ./build
    on:
      branch: prod
